import random
import pygame
import math
import sys

global oldMX
global circleonetoggle
global circleonesize
global circletwotoggle
global circletwosize
global circlethreetoggle
global circlethreesize
global rolldirection
global circleonehover
global circletwohover
global circlethreehover
global currentstate
global confirmtrigger
global mx
global my
global screen
global bodycomplete
global headchoice
global facechoice
global buttonchoice
global startingsnowstormalpha
global my_font

class Snow(pygame.sprite.Sprite): # Creates the snowflakes.
    def __init__(self):
        pygame.sprite.Sprite.__init__(self)
        snow_img = pygame.image.load("snowflake.png")
        self.image = snow_img
        self.rect = self.image.get_rect()
        self.speedx = 3
        self.speedy = random.randint(25,40) # initial speed is much faster
        self.rect.x = random.randint(-100,1920)
        self.rect.y = random.randint(-1080,-5)

    def update(self):
        
        if self.rect.bottom > 1920:
            self.speedx = 3
            self.speedy = random.randint(5,10) # Speed slows after first loop
            self.rect.x = random.randint(-1920,1920)
            self.rect.y = random.randint(-1080, -5)
        self.rect.x = self.rect.x + self.speedx
        self.rect.y = self.rect.y + self.speedy

def buildsnowman():
    global oldMX
    global circleonetoggle
    global circleonesize
    global circletwotoggle
    global circletwosize
    global circlethreetoggle
    global circlethreesize
    global rolldirection
    global circleonehover
    global circletwohover
    global circlethreehover
    global currentstate
    global confirmtrigger
    global mx
    global my

    if((oldMX != mx) and (circleonetoggle == True)): #Checks if it is time for the first circle, and if the mouse has moved
            circleonehover = 1080 - ((circleonesize/3) * 2)
            if((rolldirection == True) and (oldMX < mx)):
                circleonesize = circleonesize + 2
                if(random.randrange(1, 10) == 1):
                    rolldirection = not rolldirection # The direction was added to prevent gentle mouse movements from increasing the snow size
            elif(rolldirection == False and oldMX > mx):
                circleonesize = circleonesize + 2
                if(random.randrange(1, 10) == 1):
                    rolldirection = not rolldirection
        
    if((oldMX != mx) and (circletwotoggle == True)):
        circletwohover = 1080 - ((circletwosize/3) * 2)
        if(rolldirection == True and oldMX < mx):
            circletwosize = circletwosize + 2
            if(random.randrange(1, 10) == 1):
                rolldirection = not rolldirection
        elif(rolldirection == False and oldMX > mx):
            circletwosize = circletwosize + 2
            if(random.randrange(1, 10) == 1):
                rolldirection = not rolldirection

    if((oldMX != mx) and (circlethreetoggle == True)):
        circlethreehover = 1080 - ((circlethreesize/3) * 2)
        if(rolldirection == True and oldMX < mx):
            circlethreesize = circlethreesize + 2
            if(random.randrange(1, 10) == 1):
                rolldirection = not rolldirection
        elif(rolldirection == False and oldMX > mx):
            circlethreesize = circlethreesize + 2
            if(random.randrange(1, 10) == 1):
                rolldirection = not rolldirection
    oldMX = mx
        
    if confirmtrigger == True: # This checks if the snowball is an acceptable size
        if currentstate  == 1 and 181 > circleonesize > 140:
            circleonetoggle = False
            circletwotoggle = True
            currentstate = 2
            confirmtrigger = False
        elif currentstate == 2 and 151 > circletwosize > 110:
            circletwotoggle = False
            circlethreetoggle = True
            currentstate = 3
            confirmtrigger = False
        elif currentstate == 3 and  121 > circlethreesize > 80:
            circlethreetoggle = False
            confirmtrigger = False
            currentstate = 4
        else:
            reset()
            confirmtrigger = False
    return



def rendersnowman(): #This is what makes the snowballs, and the instruction text appear
        global bodycomplete
        if circleonetoggle == False:
            circleOne = pygame.draw.circle(screen, "white", (960,900), circleonesize, 0)
        else:
            circleBGOne = pygame.draw.circle(screen, "red", (mx,circleonehover), 240, 0)
            circleBGTwo = pygame.draw.circle(screen, "green", (mx,circleonehover), 180, 0)
            circleBGThree = pygame.draw.circle(screen, "red", (mx,circleonehover), 140, 0)
            circleOne = pygame.draw.circle(screen, "white", (mx,circleonehover), circleonesize, 0)
            text_surface = my_font.render('Time to Make a Friend!', False, (255, 255, 255))
            screen.blit(text_surface, (660,200))
            text_surfacetwo = my_font.render('Roll the snow! Click when the size is in the green area!', False, (255, 255, 255))
            screen.blit(text_surfacetwo, (260,350))
        if  currentstate >= 2:
            if circletwotoggle == False:
                circleTwo = pygame.draw.circle(screen, "white", (960,700), circletwosize, 0)
            else:
                circleBGOne = pygame.draw.circle(screen, "red", (mx,circletwohover), 210, 0)
                circleBGTwo = pygame.draw.circle(screen, "green", (mx,circletwohover), 150, 0)
                circleBGThree = pygame.draw.circle(screen, "red", (mx,circletwohover), 110, 0)
                circleTwo = pygame.draw.circle(screen, "white", (mx,circletwohover), circletwosize, 0)
                text_surface = my_font.render('Time to Make a Friend!', False, (255, 255, 255))
                screen.blit(text_surface, (660,200))
                text_surfacetwo = my_font.render('Roll the snow! Click when the size is in the green area!', False, (255, 255, 255))
                screen.blit(text_surfacetwo, (260,350))
        if  currentstate >= 3:
            if circlethreetoggle == False:
                circleThree = pygame.draw.circle(screen, "white", (960,520), circlethreesize, 0)
            else:
                circleBGOne = pygame.draw.circle(screen, "red", (mx,circlethreehover), 180, 0)
                circleBGTwo = pygame.draw.circle(screen, "green", (mx,circlethreehover), 120, 0)
                circleBGThree = pygame.draw.circle(screen, "red", (mx,circlethreehover), 80, 0)
                circleThree = pygame.draw.circle(screen, "white", (mx,circlethreehover), circlethreesize, 0)
                text_surface = my_font.render('Time to Make a Friend!', False, (255, 255, 255))
                screen.blit(text_surface, (660,200))
                text_surfacetwo = my_font.render('Roll the snow! Click when the size is in the green area!', False, (255, 255, 255))
                screen.blit(text_surfacetwo, (260,350))

def clothingchoice(): # Presents the accessories for the snowman
    if headchoice == 0 or facechoice == 0 or buttonchoice == 0:
        pygame.draw.rect(screen, "white", pygame.Rect(0, 0, 1920, 1080))
        text_surface = my_font.render('Now, select some accessories for your friend!', False, (0, 0, 0))
        screen.blit(text_surface, (260,200))
    if(headchoice == 0):
        SMHone = pygame.image.load("SMHone.png")
        screen.blit(SMHone, (380, 340))
        SMHtwo = pygame.image.load("SMHtwo.png")
        screen.blit(SMHtwo, (860, 340))
        SMHthree = pygame.image.load("SMHthree.png")
        screen.blit(SMHthree, (1340, 340))
    if(facechoice == 0):
        SMFone = pygame.image.load("SMFone.png")
        screen.blit(SMFone, (380, 540))
        SMFtwo = pygame.image.load("SMFtwo.png")
        screen.blit(SMFtwo, (860, 540))
        SMFthree = pygame.image.load("SMFthree.png")
        screen.blit(SMFthree, (1340, 540))
    if(buttonchoice == 0):
        SMBone = pygame.image.load("SMBone.png")
        screen.blit(SMBone, (380, 740))
        SMBtwo = pygame.image.load("SMBtwo.png")
        screen.blit(SMBtwo, (860, 740))
        SMBthree = pygame.image.load("SMBthree.png")
        screen.blit(SMBthree, (1340, 740))
    return

def locationCheck(): #This checks if the player has clicked on any accessories.
    global headchoice
    global facechoice
    global buttonchoice
    if(headchoice == 0):
        if 580 >= mx >= 380 and 540 >= my >= 340:
            headchoice = 1
        if 1060 >= mx >= 860 and 540 >= my >= 340:
            headchoice = 2
        if 1540 >= mx >= 1340 and 540 >= my >= 340:
            headchoice = 3
    if(facechoice == 0):
        if 580 >= mx >= 380 and 739 >= my >= 541:
            facechoice = 1
        if 1060 >= mx >= 860 and 739 >= my >= 541:
            facechoice = 2
        if 1540 >= mx >= 1340 and 739 >= my >= 541:
            facechoice = 3
    if(buttonchoice == 0):
        if 580 >= mx >= 380 and 940 >= my >= 740:
           buttonchoice = 1
        if 1060 >= mx >= 860 and 940 >= my >= 740:
            buttonchoice = 2
        if 1540 >= mx >= 1340 and 940 >= my >= 740:
            buttonchoice = 3
    if currentstate == 5:
        reset()
    return

def snowStorm(): # This creates the blinding effect, and then loads the snowman afterwards
    global startingsnowstormalpha
    global decreasealpha
    global currentstate
    s = pygame.Surface((1920,1080))  
    s.set_alpha(startingsnowstormalpha)   
    s.fill((255,255,255))       
    screen.blit(s, (0,0))   
    if (startingsnowstormalpha == 252):
        decreasealpha = True
    if decreasealpha:
        startingsnowstormalpha = startingsnowstormalpha - 3
        pygame.draw.lines(screen,[139,69,19],False,[(1260,600),(960, 700), (660, 600)],6) #snowman arms
        pygame.draw.lines(screen,[139,69,19],False,[(1260,630),(1230, 610)],6)
        pygame.draw.lines(screen,[139,69,19],False,[(660,590),(690, 610)],6)
        rendersnowman()
        text_surface = my_font.render('Well done! Click to Make a new friend!', False, (0, 0, 0))
        screen.blit(text_surface, (460,200))
        if(headchoice == 1):
            SMHone = pygame.image.load("SMHone.png")
            screen.blit(SMHone, (860, 280 + circlethreesize / 2))
        if(headchoice == 2):
            SMHtwo = pygame.image.load("SMHtwo.png")
            screen.blit(SMHtwo, (860, 300 + circlethreesize / 2))
        if(headchoice == 3):
            SMHthree = pygame.image.load("SMHthree.png")
            screen.blit(SMHthree, (860, 300 + circlethreesize / 2))
        if(facechoice == 1):
            SMFone = pygame.image.load("SMFone.png")
            screen.blit(SMFone, (860, 420))
        if(facechoice == 2):
            SMFtwo = pygame.image.load("SMFtwo.png")
            screen.blit(SMFtwo, (860, 420))
        if(facechoice == 3):
            SMFthree = pygame.image.load("SMFthree.png")
            screen.blit(SMFthree, (860, 420))
        if(buttonchoice == 1):
            SMBone = pygame.image.load("SMBone.png")
            screen.blit(SMBone, (860, 600))
        if(buttonchoice == 2):
            SMBtwo = pygame.image.load("SMBtwo.png")
            screen.blit(SMBtwo, (860, 600))
        if(buttonchoice == 3):
            SMBthree = pygame.image.load("SMBthree.png")
            screen.blit(SMBthree, (860, 600))
        currentstate = 5
    else:
        startingsnowstormalpha = startingsnowstormalpha + 4
    return

def reset():
    global oldMX
    global circleonetoggle
    global circleonesize
    global circletwotoggle
    global circletwosize
    global circlethreetoggle
    global circlethreesize
    global rolldirection
    global circleonehover
    global circletwohover
    global circlethreehover
    global currentstate
    global confirmtrigger
    global mx
    global my
    global bodycomplete
    global headchoice
    global facechoice
    global buttonchoice
    global startingsnowstormalpha
    global decreasealpha
    global currentcircle
    decreasealpha = False
    oldMX = 0
    circleonetoggle = True
    circleonesize = 30
    circletwotoggle = False
    circletwosize = 30
    circlethreetoggle = False
    circlethreesize = 30
    rolldirection = True
    circleonehover = 0
    circletwohover = 0
    circlethreehover = 0
    currentcircle = 1
    bodycomplete = False
    headchoice = 0
    facechoice = 0
    buttonchoice = 0
    startingsnowstormalpha = 0
    currentstate = 1
    return



def main():
    global oldMX
    global circleonetoggle
    global circleonesize
    global circletwotoggle
    global circletwosize
    global circlethreetoggle
    global circlethreesize
    global rolldirection
    global circleonehover
    global circletwohover
    global circlethreehover
    global currentstate
    global confirmtrigger
    global mx
    global my
    global screen
    global bodycomplete
    global headchoice
    global facechoice
    global buttonchoice
    global startingsnowstormalpha
    global decreasealpha
    global my_font
    decreasealpha = False
    oldMX = 0
    circleonetoggle = True
    circleonesize = 30
    circletwotoggle = False
    circletwosize = 30
    circlethreetoggle = False
    circlethreesize = 30
    rolldirection = True
    circleonehover = 0
    circletwohover = 0
    circlethreehover = 0
    currentstate = 1
    confirmtrigger = False
    bodycomplete = False
    headchoice = 0
    facechoice = 0
    buttonchoice = 0
    startingsnowstormalpha = 0
    pygame.init()
    pygame.font.init()
    my_font = pygame.font.SysFont('Comic Sans MS', 60)
    pygame.display.set_caption("Make a Friend!")
    clock = pygame.time.Clock()
    dt = 0
    resolution = (1920, 1080)
    screen = pygame.display.set_mode(resolution)
    running = True

    snow_group = pygame.sprite.Group()
    snow_img = pygame.image.load("snowflake.png")

    for i in range(500): #Creates 500 snowflakes
        snow = Snow()
        snow_group.add(snow)
    
    
    
    while running:
        # Event Loop 
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running = False
            if event.type == pygame.MOUSEBUTTONDOWN:
                if bodycomplete == False:
                    confirmtrigger = True
                else:
                    locationCheck()
                    

        # Game logic
        pressedkey = pygame.key.get_pressed()
        mx, my = pygame.mouse.get_pos()
        buildsnowman()
        # Render & Display
        black = pygame.Color(0, 0, 0)
        screen.fill(black)
        if headchoice != 0 and facechoice != 0 and buttonchoice != 0:
            background = pygame.image.load("SMbackground.png")
            screen.blit(background, (0, 0))
            snow_group.update()
            snow_group.draw(screen)
            snowStorm()
        if currentstate <= 3:
            rendersnowman()
        if currentstate == 4:
            bodycomplete = True
            clothingchoice()
        pygame.display.flip()
        dt = clock.tick(22)
    pygame.quit()

if __name__ == "__main__":
    main()
